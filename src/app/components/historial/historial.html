<div class="historial-container">

  <h2>Historial de reportes</h2>

  <p class="descripcion">
    Aquí puedes revisar y volver a descargar los reportes generados.
  </p>

  <!-- Si el historial está vacío -->
  <div *ngIf="historial.length === 0" class="vacio">
    <p>No hay reportes guardados aún.</p>
  </div>

  <!-- Tabla con scroll -->
  <div class="tabla-scroll" *ngIf="historial.length > 0">

    <table mat-table [dataSource]="historial" class="mat-elevation-z2">

      <!-- Nombre -->
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef>Nombre</th>
        <td mat-cell *matCellDef="let h">{{ h.nombre }}</td>
      </ng-container>

      <!-- Tipo -->
      <ng-container matColumnDef="tipo">
        <th mat-header-cell *matHeaderCellDef>Tipo</th>
        <td mat-cell *matCellDef="let h">
          <span class="chip" [ngClass]="h.tipo">
            {{ h.tipo | uppercase }}
          </span>
        </td>
      </ng-container>

      <!-- Fecha -->
      <ng-container matColumnDef="fecha">
        <th mat-header-cell *matHeaderCellDef>Fecha</th>
        <td mat-cell *matCellDef="let h">{{ h.fecha }}</td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let h">

          <!-- Menú desplegable para elegir formato -->
          <button mat-icon-button [matMenuTriggerFor]="menuFormatos">
            <mat-icon>download</mat-icon>
          </button>

          <mat-menu #menuFormatos="matMenu">
            <button mat-menu-item (click)="descargar(h, 'pdf')">Descargar PDF</button>
            <button mat-menu-item (click)="descargar(h, 'excel')">Descargar Excel</button>
          </mat-menu>

          <!-- Borrar reporte -->
          <button mat-icon-button color="warn" (click)="borrar(h)">
            <mat-icon>delete</mat-icon>
          </button>

        </td>
      </ng-container>

      <!-- Render table -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

    </table>

  </div>

  <!-- Botón limpiar historial -->
  <button mat-stroked-button color="warn" class="btn-limpiar" (click)="limpiarTodo()">
    Limpiar historial completo
  </button>

</div>
