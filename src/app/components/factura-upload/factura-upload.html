<div class="container">

  <mat-card class="upload-card">

    <h2 class="titulo">Cargar Facturas</h2>

    <!-- Input file oculto -->
    <input #fileInput type="file" multiple accept=".xlsx, .xls, .pdf" style="display: none"
      (change)="onFilesSelected($event)" />

    <!-- BotÃ³n subir -->
    <button mat-raised-button color="primary" (click)="fileInput.click()">
      ðŸ“‚ Seleccionar archivos
    </button>

    <p class="subtexto">Formatos permitidos: PDF, XLSX, XLS</p>

    <!-- ======================================= -->
    <!--   LISTA CON SCROLL Y TODAS LAS FILAS   -->
    <!-- ======================================= -->
    <div *ngIf="dataSource.data.length > 0">

      <h3 class="subtitulo">Facturas cargadas ({{ dataSource.data.length }})</h3>

      <!-- Scroll container -->
      <div class="lista-facturas-scroll">

        <table mat-table [dataSource]="dataSource" class="mat-elevation-z2 tabla-facturas">

          <!-- NÃºmero -->
          <ng-container matColumnDef="n">
            <th mat-header-cell *matHeaderCellDef>#</th>
            <td mat-cell *matCellDef="let f; let i = index">{{ i + 1 }}</td>
          </ng-container>

          <!-- Nombre archivo -->
          <ng-container matColumnDef="nombre">
            <th mat-header-cell *matHeaderCellDef>Nombre</th>
            <td mat-cell *matCellDef="let f">{{ f.fileName }}</td>
          </ng-container>

          <!-- Productos detectados -->
          <ng-container matColumnDef="productos">
            <th mat-header-cell *matHeaderCellDef>Productos</th>
            <td mat-cell *matCellDef="let f">{{ f.productos.length }}</td>
          </ng-container>

          <!-- Eliminar factura (opcional) -->
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef>Acciones</th>
            <td mat-cell *matCellDef="let f; let i = index">
              <button mat-icon-button color="warn" (click)="eliminarFactura(i)" matTooltip="Eliminar factura">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <!-- IMPORTANTE: Definir las filas -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        </table>

      </div>

      <!-- Botones con mejor espaciado -->
      <div class="botones-accion">
        <button mat-flat-button color="primary" class="btn-guardar" (click)="guardarFacturas()">
          <mat-icon>save</mat-icon>
          Guardar y continuar
        </button>

        <button mat-stroked-button color="warn" class="btn-limpiar" (click)="limpiarTodo()">
          <mat-icon>delete_sweep</mat-icon>
          Limpiar todo
        </button>
      </div>

    </div>

    <p *ngIf="dataSource.data.length === 0" class="sin-facturas">No hay facturas cargadas.</p>

  </mat-card>

</div>
